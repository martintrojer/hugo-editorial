{{ define "main" }}

<!-- Main -->
<div id="main">
	<div class="inner">
		{{ partial "header" site.Data.header }}
		<section>

        <div class="posts">
        {{ range .Pages.ByDate.Reverse }}
            {{- $image := resources.Get .Params.thumb -}}
            {{- $placeholder := "/images/placeholder-5x3.svg" -}}
            {{- $minW := 400 -}}
            {{- $minH := 240 -}}
            {{- $w1 := 400 -}}
            {{- $h1 := 240 -}}
            {{- $w2 := 800 -}}
            {{- $h2 := 480 -}}
            {{- $thumb1x := false -}}
            {{- $thumb2x := false -}}
            {{- if and $image (ge $image.Width $minW) (ge $image.Height $minH) -}}
              {{- $thumb1x = $image.Fill (printf "%dx%d Smart q85" $w1 $h1) | resources.Fingerprint -}}
              {{- if and (ge $image.Width $w2) (ge $image.Height $h2) -}}
                {{- $thumb2x = $image.Fill (printf "%dx%d Smart q80" $w2 $h2) | resources.Fingerprint -}}
              {{- end -}}
            {{- end -}}
            {{- if $image -}}
              {{- $image = $image | resources.Fingerprint -}}
            {{- end -}}
            <article>
                    <a href="{{ .RelPermalink }}" class="card-link">
                        <span class="image">
                            {{- if $thumb1x -}}
                              {{- $webp1x := $image.Fill (printf "%dx%d Smart webp q85" $w1 $h1) | resources.Fingerprint -}}
                              {{- $webp2x := false -}}
                              {{- if $thumb2x -}}
                                {{- $webp2x = $image.Fill (printf "%dx%d Smart webp q80" $w2 $h2) | resources.Fingerprint -}}
                              {{- end -}}
                              <picture>
                                <source type="image/webp"
                                        {{- if $webp2x }} srcset="{{ $webp1x.RelPermalink }} 400w, {{ $webp2x.RelPermalink }} 800w"{{ else }} srcset="{{ $webp1x.RelPermalink }} 400w"{{ end -}}
                                        sizes="(max-width: 600px) 100vw, 400px">
                                <img src="{{ $thumb1x.RelPermalink }}"
                                     {{- if $thumb2x }} srcset="{{ $thumb1x.RelPermalink }} 400w, {{ $thumb2x.RelPermalink }} 800w"{{ end -}}
                                     sizes="(max-width: 600px) 100vw, 400px"
                                     alt="" />
                              </picture>
                            {{- else -}}
                              <img src="{{ $placeholder }}" alt="" />
                            {{- end -}}
                        </span>
                        <h3>{{ .Params.title }}</h3>
                        {{ with .Params.date }} <h4>{{ . | time.Format ":date_medium" }}</h4> {{ end }}
                        {{ with .Params.summary }}<p>{{ . | plainify }}</p>{{ end }}
                    </a>
            </article>
        {{ end }}
        </div>

		</section>
	</div>
</div>
{{ partial "sidebar" site.Data.sidebar }}

{{ end }}
